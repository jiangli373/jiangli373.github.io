<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 頁 | jiangli&#39;s blog</title>
  <meta name="author" content="jiangli">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="jiangli&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="jiangli&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<div style="display:none">
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253342057'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1253342057%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</div>

</head>

<body>
  <header id="header" class='normal_mode'>
    <nav id="main-nav">
  <ul class='container'>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/about">关于我</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
  </header>
  <div id="content" class="container">
    <div id="cover">
	<div id="profile" alt="http://7xi45j.com1.z0.glb.clouddn.com/background-cover.jpg">
		<a href="/">
			<div class="logo">
				<img src="/logo.png" alt="Profile Picture">
			</div>
			<div id="title">jiangli's blog</div>
		</a>

		
		 <ul class="my-socials">
  
  <li>
  	<a href="hhttps://github.com/jiangli373" class="github" target="_blank">
  		<i class="fa fa-github"></i>
  	</a>
  </li>
  
  <li>
  	<a href="http://weibo.com/2460847854/profile?topnav=1&wvr=6" class="weibo" target="_blank">
  		<i class="fa fa-weibo"></i>
  	</a>
  </li>
  
 
 <li>
   	<a href="mailto:715015723@qq.com" class="email" target="_blank" title="Email Me">
  		<i class="fa fa-envelope"></i>
  	</a>
 </li>
 
  
  <li>
   <a href="/atom.xml" class="email" target="_blank" title="订阅">
    <i class="fa fa-rss"></i>
   </a>
  </li>
  
</ul>
	</div>
</div>


  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T08:16:22.000Z"><a href="/2014/10/08/ubuntu-server安装node-js/">Wed, Oct 8 2014, 4:16:22 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu-server安装node-js/">ubuntu server安装node.js</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/node-js/">node.js</a>, <a href="/tags/ubuntu/">ubuntu</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>1.安装node.js环境  </p>
<pre><code>sudo apt-<span class="built_in">get</span> install g++ curl libssl-<span class="built_in">dev</span> apache2-utils

要确保安装了git  

sudo apt-<span class="built_in">get</span> -y install git-core
</code></pre><p>2.通过git下载源代码：</p>
<pre><code>git clone <span class="string">git:</span><span class="comment">//github.com/joyent/node.git</span>
</code></pre><p>3.进入到node目录下，编译安装</p>
<pre><code>./configure
<span class="built_in">make</span>
sudo <span class="built_in">make</span> install
</code></pre><p>注：如果没有安装make的话，需要先安装make sudo apt-get install make</p>
<p>4.编译成功后，可以通过node -v查看当前版本号</p>
<p>5.安装npm</p>
<pre><code>curl -<span class="keyword">k</span> http<span class="variable">s:</span>//npmjs.org/install.<span class="keyword">sh</span> | sudo <span class="keyword">sh</span>
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu-server安装node-js/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu-server安装node-js/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu-server安装node-js/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T08:14:36.000Z"><a href="/2014/10/08/ubuntu安装logwacth/">Wed, Oct 8 2014, 4:14:36 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu安装logwacth/">ubuntu安装logwacth</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/ubuntu/">ubuntu</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>安装logwatch的前提条件：</p>
<p>Prerequisites  </p>
<p> Ensure email is working. Instructions for doing so may be found in MailServer.</p>
<p> Turn on universe repository. Instructions for doing so may be found in Repositories.</p>
<p>1.首先安装MailServer</p>
<p>我安装的是Postfix</p>
<pre><code>sudo apt-<span class="keyword">get</span> install <span class="keyword">postfix</span>
</code></pre><p>安装的时候会出现配置，默认选项就可以。</p>
<p>如果安装完成后，你想修改配置文件，可以使用如下命令：</p>
<pre><code><span class="title">sudo</span> dpkg-reconfigure postfix
</code></pre><p>2.MailServer安装完成后，就是安装logwatch。方法很简单</p>
<pre><code>sudo apt-<span class="keyword">get</span> install logwatch
</code></pre><p>3.安装后一般可配置为使用邮件方式通知，需要修改配置文件：</p>
<pre><code>sudo vi <span class="regexp">/usr/</span>share<span class="regexp">/logwatch/</span><span class="keyword">default</span>.conf/logwatch.conf

修改如下参数
Output = mail

Format = html

MailTo = somebody<span class="annotation">@qq</span>.com
</code></pre><p>4.logwatch安装时会设置cron定时任务，配置文件在：</p>
<pre><code>sudo vi /etc/cron.daily/<span class="number">00l</span>ogwatch
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu安装logwacth/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu安装logwacth/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu安装logwacth/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T08:00:45.000Z"><a href="/2014/10/08/mongodb备份和修复/">Wed, Oct 8 2014, 4:00:45 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/mongodb备份和修复/">mongodb备份和修复</a></h1>
  



<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>mongodb备份</p>
<p>1.执行如下命令</p>
<pre><code>mongodump  <span class="operator">-d</span> spy  -o new_back

<span class="operator">-d</span>指定了要备份的数据库，-o指定要将备份的数据库存放位置
</code></pre><p><img src="/img/149160bd67e03669f65bc1d2ec57d74a.png" alt=""></p>
<p>完成以后，可以在new_back目录下找到刚才备份玩的数据</p>
<p>mongodb恢复</p>
<p>1.执行下面的命令</p>
<pre><code>mongorestore -<span class="keyword">d</span> spy --<span class="keyword">drop</span> new_back/spy/

-<span class="keyword">d</span>制定要恢复的数据库，--<span class="keyword">drop</span>代表在恢复之前删除集合，否则数据就会与现有的数据库合并。backup/myDemo/制定备份的数据库位置。
</code></pre><p><img src="/img/d029442130bf04f8210e51734b5e17d0.png" alt="">     </p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/mongodb备份和修复/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/mongodb备份和修复/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/mongodb备份和修复/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T07:56:44.000Z"><a href="/2014/10/08/ubuntu-使用iptables创建防火墙/">Wed, Oct 8 2014, 3:56:44 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu-使用iptables创建防火墙/">ubuntu 使用iptables创建防火墙</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/iptables/">iptables</a>, <a href="/tags/ubuntu/">ubuntu</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>iptables是Linux上常用的防火墙软件，下面就介绍下怎么通过iptables创建防火墙</p>
<p>1.检查下你的服务器是否有了默认的防火墙设置</p>
<pre><code><span class="title">sudo</span> iptables -L
</code></pre><p>如果没有设置话，会输出空白的结果，如下所示：</p>
<pre><code><span class="constant">Chain</span> <span class="constant">I</span>NPUT (policy <span class="constant">A</span>CCEPT)
<span class="literal">target</span>     prot opt <span class="literal">source</span>               destination

<span class="constant">Chain</span> <span class="constant">F</span>ORWARD (policy <span class="constant">A</span>CCEPT)
<span class="literal">target</span>     prot opt <span class="literal">source</span>               destination

<span class="constant">Chain</span> <span class="constant">O</span>UTPUT (policy <span class="constant">A</span>CCEPT)
<span class="literal">target</span>     prot opt <span class="literal">source</span>               destination
</code></pre><p>2.可以使用下面的命令创建防火墙规则：</p>
<pre><code>sudo vi /etc/iptables<span class="class">.firewall</span><span class="class">.rules</span>
</code></pre><p>一个简单的例子如下所示：</p>
<pre><code><span class="comment">*filter</span>

#  Allow all loopback (lo0) traffic and <span class="keyword">drop</span> all traffic to 127/8 that doesn't <span class="keyword">use</span> lo0
-A <span class="keyword">INPUT</span> -i lo -j ACCEPT
-A <span class="keyword">INPUT</span> -<span class="keyword">d</span> 127.0.0.0/8 -j REJECT

#  允许已建立的或相关连的通行
-A <span class="keyword">INPUT</span> -<span class="keyword">m</span> state --state ESTABLISHED,RELATED -j ACCEPT

#  允许所有本机向外的访问
-A OUTPUT -j ACCEPT

# 开发80和443端口
-A <span class="keyword">INPUT</span> -p tcp --dport 80 -j ACCEPT
-A <span class="keyword">INPUT</span> -p tcp --dport 443 -j ACCEPT

#允许ssh登录，这里的dport需要和你再sshd_config里面配置的一致
-A <span class="keyword">INPUT</span> -p tcp -<span class="keyword">m</span> state --state NEW --dport 22 -j ACCEPT

#  是否允许ping，注释掉则不允许
-A <span class="keyword">INPUT</span> -p icmp -j ACCEPT

#  <span class="keyword">Log</span> iptables denied calls
# --limit 对由此规则引发的记录事件的频率进行限制
# --<span class="keyword">log</span>-prefix 在每条记录前加上一个前缀，以便查找
-A <span class="keyword">INPUT</span> -<span class="keyword">m</span> limit --limit 5/min -j <span class="keyword">LOG</span> --<span class="keyword">log</span>-prefix <span class="string">"iptables denied: "</span> --<span class="keyword">log</span>-level 7

#  <span class="keyword">Drop</span> all other inbound - default deny unless explicitly allowed policy去掉上面规则外
-A <span class="keyword">INPUT</span> -j <span class="keyword">DROP</span>
-A FORWARD -j <span class="keyword">DROP</span>

COMMIT
</code></pre><p>保存，退出</p>
<p>3.上面的规则，开放了80，443，22端口，其它的端口被屏蔽掉了，而且不允许ping</p>
<p>4.激活防火墙使用下面的命令：</p>
<pre><code>sudo iptables-restore &lt; /etc/iptables<span class="class">.firewall</span><span class="class">.rules</span>
</code></pre><p>再次使用sudo iptables -L 查看</p>
<p>5.可以测试下ping这个服务器：现在是ping不通的。</p>
<p>6.为了保证你每次重启你的服务器你的防火墙规则是有效的，需要创建一个脚本：</p>
<pre><code>sudo vi /etc/network/<span class="keyword">if</span>-pre-up.d/firewall

<span class="shebang">#!/bin/sh</span>
/sbin/iptables-restore &lt; /etc/iptables.firewall.rules
</code></pre><p>7.改变这个脚本的读写权限：</p>
<pre><code>sudo chmod +<span class="keyword">x</span> /etc/network/<span class="keyword">if</span>-<span class="keyword">pre</span>-<span class="keyword">up</span>.<span class="keyword">d</span>/firewall
</code></pre><p>上面就是一个简单的配置。</p>
<p>8.如果我们想指定某个ip通过ssh访问的话，可以这样</p>
<pre><code>-A INPUT -s <span class="number">192.168</span>.<span class="number">0.3</span> -<span class="tag">p</span> tcp --dport <span class="number">22</span> -j ACCEPT
</code></pre><p><img src="/img/d57eb34086a06b5b3e69be7b0808a0f5.png" alt=""></p>
<p>从150ssh登录110则超时</p>
<p><img src="/img/89182a7251d88b51f0148b03c63fac8e.png" alt=""></p>
<p>如果要允许,或限制一段IP地址可用 192.168.0.0/24 表示192.168.0.1-255端的所有IP</p>
<p>可以通过查看/var/log/syslog看到拒绝的日志：</p>
<p><img src="/img/2b9c4389905ecdd985aa091a44765154.png" alt=""></p>
<p>ps:</p>
<pre><code>sudo   iptables -F        清除预设表<span class="built_in">filter</span>中的所有规则链的规则

sudo   iptables -X        清除预设表<span class="built_in">filter</span>中使用者自定链中的规则

iptables <span class="comment">--help            查看帮助</span>
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu-使用iptables创建防火墙/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu-使用iptables创建防火墙/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu-使用iptables创建防火墙/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T07:50:04.000Z"><a href="/2014/10/08/ubuntu系统启动运行时间/">Wed, Oct 8 2014, 3:50:04 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu系统启动运行时间/">ubuntu系统启动运行时间</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/ubuntu/">ubuntu</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <h3 id="第一个数字代表已经运行的时间">第一个数字代表已经运行的时间</h3><pre><code>$cat /<span class="keyword">proc</span>/uptime

<span class="number">31341</span>.<span class="number">94</span>
</code></pre><h3 id="可以用date命令来计算出系统的启动时间">可以用date命令来计算出系统的启动时间</h3><pre><code><span class="variable">$date</span> -d <span class="string">"<span class="variable">$(</span>awk -F. '{print <span class="variable">$1</span>}' /proc/uptime) second ago"</span> +<span class="string">"<span class="variable">%Y</span>-<span class="variable">%m</span>-<span class="variable">%d</span> <span class="variable">%H</span>:<span class="variable">%M</span>:<span class="variable">%S</span>"</span>

<span class="number">2011</span>-<span class="number">03</span>-<span class="number">17</span> <span class="number">00</span>:<span class="number">50</span>:<span class="number">51</span>
</code></pre><h3 id="使用date命令计算系统的运行时间">使用date命令计算系统的运行时间</h3><pre><code>$ cat /<span class="keyword">proc</span>/uptime| awk -F. '{run_days=$<span class="number">1</span> / <span class="number">86400</span>;run_hour=($<span class="number">1</span> % <span class="number">86400</span>)/<span class="number">3600</span>;run_minute=($<span class="number">1</span> % <span class="number">3600</span>)/<span class="number">60</span>;run_second=$<span class="number">1</span> % <span class="number">60</span>;printf(<span class="string">"系统已运行：%d天%d时%d分%d秒\n"</span>,run_days,run_hour,run_minute,run_second)}'

系统已运行：<span class="number">0</span>天<span class="number">8</span>时<span class="number">45</span>分<span class="number">27</span>秒
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu系统启动运行时间/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu系统启动运行时间/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu系统启动运行时间/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T07:47:24.000Z"><a href="/2014/10/08/ubuntu-server多用户共享版本库/">Wed, Oct 8 2014, 3:47:24 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu-server多用户共享版本库/">ubuntu server多用户共享版本库</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/git/">git</a>, <a href="/tags/ubuntu-server/">ubuntu server</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>问题：远程版本库使用gitolite，客户端需要克隆版本库，<br>需要把客户的公钥放入到gitolite上面去，可以算是一个萝卜一个坑，<br>其实就是通过密钥对来控制对远程版本库的访问。现在的问题是，<br>一个服务器上有个用户克隆下来了远程的版本库，如果远程版本库有更新，服务器需要同步更新，<br>这时就有问题出来了，每次更新都得这个用户才能更新，如果这个用户不在的话，岂不是更新不了了？</p>
<p>解决方法：</p>
<p>下面以git用户为例，git用户有访问远程版本库的权限，jiangli是待授权用户  </p>
<p>1.首先需要把git用户的私钥给各个用户发一下</p>
<p>git用户密钥位置：/home/git/.ssh/</p>
<p>如果生成密钥的时候用的是默认值的话，私钥的名字是id_rsa，把这个用户给各个用户，得到私钥的用户jiangli，需要把改密钥放在自己用户目录下的.ssh目录下</p>
<pre><code><span class="regexp">/home/</span>jiangli<span class="regexp">/.ssh/</span>

sudo chown <span class="string">jiangli:</span>jiang id_rsa

sudo chmod <span class="number">400</span> id_rsa
</code></pre><hr>
<p>ps:如果jiangli这个用户已经有了别的版本库的读写权限，该怎么办呢？</p>
<p>1.首先给.ssh/目录下的密钥改下名字，例如这样：</p>
<p><img src="/img/2c705cb8eb4842db8eacdbdf56ae7d2f.png" alt=""></p>
<p>然后新建一个config文件</p>
<pre><code>vi config

<span class="keyword">host</span> gitolite
     <span class="keyword">user</span> git
     <span class="built_in">hostname</span> 域名或者<span class="literal">ip</span>
     port <span class="number">10080</span>
     identityfile ~/.ssh/id_rsa
<span class="keyword">host</span> devwitmob
     <span class="keyword">user</span> git
     <span class="built_in">hostname</span> 域名或者<span class="literal">ip</span>
     port <span class="number">22</span>
    identityfile ~/.ssh/devwitmob
</code></pre><hr>
<p>2.例如git用户把项目克隆到/srv/test目录下，项目名称SpySprite,我们需要改变这个目录的读写权限</p>
<pre><code>sudo chmod <span class="number">777</span> -R /srv/<span class="built_in">test</span>/SpySprite
</code></pre><p><img src="/img/9f8fa22d3749526a9fb35372b70f1d60.png" alt=""></p>
<p>3.上面两步完成以后，有私钥的用户就可以执行git pull命令执行更新了</p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu-server多用户共享版本库/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu-server多用户共享版本库/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu-server多用户共享版本库/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T07:06:47.000Z"><a href="/2014/10/08/gitolite-导入gitlab/">Wed, Oct 8 2014, 3:06:47 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/gitolite-导入gitlab/">gitolite 导入gitlab</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/gitlab/">gitlab</a>, <a href="/tags/gitolite/">gitolite</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>很久以前项目是用gitolite做为远程版本库管理的工具，后来发现了gitlab，一款类似github的工具，很不赖，<br>所以决定以后都用gitlab了，需要把以前gitolite的项目搞过来。</p>
<p>参考：<a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/maintenance.md" target="_blank" rel="external">https://github.com/gitlabhq/gitlabhq/blob/master/doc/raketasks/maintenance.md</a></p>
<p>目前gitlab的repositories与gitolite的在同一个目录下  </p>
<p>1.把gitolite中的repositories  cp到gitlab的repository/root里面去</p>
<p>2.在gitlab目录下执行  </p>
<pre><code>bundle exec rake <span class="string">gitlab:</span><span class="string">import:</span>repos RAILS_ENV=production

bundle exec rake <span class="string">gitlab:</span><span class="string">satellites:</span>create RAILS_ENV=production
</code></pre><p>注：gitlab的版本库目录权限   后面目录根据实际情况改变</p>
<pre><code>sudo chmod -R ug+rwX,o-rwx <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>
sudo chmod -R ug-s <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span>
<span class="keyword">find</span> <span class="regexp">/home/gi</span>t<span class="regexp">/repositories/</span> -type d -print0 | sudo xargs -<span class="number">0</span> chmod g+s
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/gitolite-导入gitlab/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/gitolite-导入gitlab/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/gitolite-导入gitlab/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T07:02:18.000Z"><a href="/2014/10/08/nginx直接返回json/">Wed, Oct 8 2014, 3:02:18 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/nginx直接返回json/">nginx直接返回json</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/nginx/">nginx</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>nginx [engine x]是Igor Sysoev编写的一个HTTP和反向代理服务器，另外它也可以作为邮件代理服务器。 它已经在众多流量很大的俄罗斯网站上使用了很长时间，这些网站包括Yandex、Mail.Ru、VKontakte，以及Rambler。</p>
<p>—摘自<a href="http://nginx.org/cn/" target="_blank" rel="external">nginx官网</a></p>
<p>项目使用nginx做代理，如果遇到项目升级，我们要告知手机客户端当前服务不可用，我们又不想专门起一个项目来做这件事，<br>这里可以使用nginx的配置来解决这件事。</p>
<pre><code>location ^~/api/ {
    default_type <span class="type">application</span>/json;
<span class="command">    return</span> <span class="number">200</span> '{<span class="string">"ret"</span>:<span class="string">"-11"</span>,<span class="string">"msg"</span>:<span class="string">"尊敬的客户：由于后台系统升级维护，给您带来不便请见谅。"</span>}';
}
</code></pre><p>当请求的路径是以/api 开头的话，都会由这个处理。</p>
<p>可能返回的json中，中文会有乱码问题：参考下面的地址：  </p>
<p><a href="http://serverfault.com/questions/312177/how-to-enable-correct-charset-http-header-in-nginx" target="_blank" rel="external">http://serverfault.com/questions/312177/how-to-enable-correct-charset-http-header-in-nginx</a>  </p>
<p><a href="http://nginx.org/en/docs/http/ngx_http_charset_module.html#charset_types" target="_blank" rel="external">http://nginx.org/en/docs/http/ngx_http_charset_module.html#charset_types</a></p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/nginx直接返回json/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/nginx直接返回json/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/nginx直接返回json/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T06:49:32.000Z"><a href="/2014/10/08/ubuntu-server使用logrotate切割日志/">Wed, Oct 8 2014, 2:49:32 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/ubuntu-server使用logrotate切割日志/">ubuntu server使用logrotate切割日志</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/linux/">linux</a>, <a href="/tags/logrotate/">logrotate</a>, <a href="/tags/ubuntu-server/">ubuntu server</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>logrotate 程序是一个日志文件管理工具。用来把旧的日志文件删除，并创建新的日志文件，我们把它叫做“转储”。<br>我们可以根据日志文件的大小，也可以根据其天数来转储，这个过程一般通过 cron 程序来执行。</p>
<p>ubuntu server默认已经安装了logrotate</p>
<p>1.在/etc/logrotate.d目录下新建一个文件：</p>
<pre><code>sudo vi foreverout 

/opt/work/<span class="keyword">log</span>/wodi/<span class="keyword">out</span>.<span class="keyword">log</span> {
<span class="literal">daily</span>
<span class="keyword">rotate</span> 5
missingok
size 1M
notifempty
copytruncate
}

/opt/work/<span class="keyword">log</span>/wodi/<span class="keyword">out</span>.<span class="keyword">log</span>  是你的日志目录
</code></pre><p>ps:logrotate 的主要参数如下表：</p>
<pre><code>参数                         功能
   compress                     通过gzip 压缩转储以后的日志
   nocompress                   不需要压缩时，用这个参数
   copytruncate                 用于还在打开中的日志文件，把当前日志备份并截断
   nocopytruncate               备份日志文件但是不截断
   <span class="operator"><span class="keyword">create</span> <span class="keyword">mode</span> owner <span class="keyword">group</span>      转储文件，使用指定的文件模式创建新的日志文件
   nocreate                     不建立新的日志文件
   delaycompress 和 <span class="keyword">compress</span> 一起使用时，转储的日志文件到下一次转储时才压缩
   nodelaycompress              覆盖 delaycompress 选项，转储同时压缩。
   <span class="keyword">errors</span> address               专储时的错误信息发送到指定的Email 地址
   ifempty                      即使是空文件也转储，这个是 logrotate 的缺省选项。
   notifempty                   如果是空文件的话，不转储
   mail address                 把转储的日志文件发送到指定的E-mail 地址
   nomail                       转储时不发送日志文件
   olddir directory             转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统
   noolddir                     转储后的日志文件和当前日志文件放在同一个目录下
   prerotate/endscript          在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行
   postrotate/endscript         在转储以后需要执行的命令可以放入这个对，这两个关键字必须单独成行
   daily                        指定转储周期为每天
   weekly                       指定转储周期为每周
   monthly                      指定转储周期为每月
   rotate <span class="keyword">count</span>                 指定日志文件删除之前转储的次数，<span class="number">0</span> 指没有备份，<span class="number">5</span> 指保留<span class="number">5</span> 个备份
   tabootext [+] list           让logrotate 不转储指定扩展名的文件，缺省的扩展名是：.rpm-orig, .rpmsave, v, 和 ~
   <span class="keyword">size</span> <span class="keyword">size</span>                    当日志文件到达指定的大小时才转储，<span class="keyword">Size</span> 可以指定 bytes (缺省)以及KB (sizek)或者MB (sizem).</span>
</code></pre><p>2.可以通过下面的命令来测试上面的文件是否正确：</p>
<pre><code>sudo logrotate <span class="operator">-f</span> /etc/logrotate.d/foreverout
</code></pre><p>在 /opt/work/log/wodi/out.log会产生</p>
<pre><code><span class="keyword">out</span>.<span class="built_in">log</span>
<span class="keyword">out</span>.<span class="built_in">log</span><span class="number">.1</span>
</code></pre><p>3.让logrotate每天进行一次滚动,在crontab中添加一行定时脚本</p>
<pre><code>sudo crontab -e

<span class="number">59</span> <span class="number">23</span>  * * *   <span class="regexp">/usr/sbin</span><span class="regexp">/logrotate -f /etc</span><span class="regexp">/logrotate.d/foreverout</span>
</code></pre><p>每天23时59分执行这个命令</p>
<p>写好计划任务后，还需要重启cron来应用这个计划任务</p>
<pre><code>sudo <span class="keyword">service</span> <span class="keyword">cron</span> <span class="literal">restart</span>
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/ubuntu-server使用logrotate切割日志/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/ubuntu-server使用logrotate切割日志/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/ubuntu-server使用logrotate切割日志/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
      <time datetime="2014-10-08T06:43:18.000Z"><a href="/2014/10/08/Get-the-text-after-span-element-using-jquery/">Wed, Oct 8 2014, 2:43:18 pm</a></time>

  
    <h1 class="title"><a href="/2014/10/08/Get-the-text-after-span-element-using-jquery/">Get the text after span element using jquery</a></h1>
  



  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/jquery/">jquery</a>
  </div>

<div class="clear"></div>
      
    </header>
    <div class="entry">
      
        <p>Get the text after span element using jquery</p>
<pre><code>&lt;<span class="operator">div</span> id=<span class="string">"mydiv"</span>&gt;
    &lt;<span class="operator">div</span>&gt;
        &lt;span&gt;Text inside span&lt;/span&gt;
        Text next <span class="built_in">to</span> span
    &lt;/<span class="operator">div</span>&gt;
    &lt;<span class="operator">div</span>&gt;
        Contents inside <span class="operator">the</span> <span class="number">2</span>nd <span class="operator">div</span> <span class="keyword">element</span>...
    &lt;/<span class="operator">div</span>&gt;
&lt;/<span class="operator">div</span>&gt;
</code></pre><p>如果想取得上面html代码中的”Text next to span”，使用下面的方法即可：</p>
<pre><code><span class="keyword">var</span> a = $(<span class="string">'#mydiv div'</span>).first().contents().filter(<span class="function"><span class="keyword">function</span><span class="params">()</span><span class="comment">{
    returnthis.nodeType ==3;
}</span>).<span class="title">text</span><span class="params">()</span>;</span>
</code></pre>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2014/10/08/Get-the-text-after-span-element-using-jquery/#more" class="more-link"><i class="fa fa-chevron-right"></i>Read More</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://www.nuonuo.me/2014/10/08/Get-the-text-after-span-element-using-jquery/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2014/10/08/Get-the-text-after-span-element-using-jquery/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/" class="alignleft prev"><i class="fa fa-long-arrow-left"></i>上一頁</a>
  
  
    <a href="/page/3/" class="alignright next">下一頁<i class="fa fa-long-arrow-right"></i></a>
  
  <div class="clearfix"></div>
</nav>

<script src="/js/jquery.anystretch.min.js" type="text/javascript"></script>
<script src="/js/cover.js" type="text/javascript"></script>

    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2015 jiangli
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="external">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="external">GitHub Pages</a>

<div class="clearfix"></div></footer>
  
<script src="/js/jquery.imagesloaded.min.js" type="text/javascript"></script>
<script src="/js/gallery.js" type="text/javascript"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js" type="text/javascript"></script>




    <script type="text/javascript">
        (function(){

            $(window).scroll(function(){

                var scrollTop = $(window).scrollTop();
                if ( scrollTop >200 ){
                    $("#main-nav").removeClass('normal_mode').addClass('top_mode');
                } else{
                    $("#main-nav").removeClass('top_mode').addClass('normal_mode');
                }

            });

        })();
    </script>



  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>



    
    <script type="text/javascript">
      var duoshuoQuery = {short_name:"nuonuo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = 'http://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>



<script type="text/javascript">
  
  $(function(){

    $('.title').hover(
      function() {      
        $(this).stop().animate(
          {'marginLeft': '10px'}, 200
        );   
      }, 
      function() {       
        $(this).stop().animate({'marginLeft': '0px'}, 200);      
      
    });   

  });

</script>


</body>
</html>